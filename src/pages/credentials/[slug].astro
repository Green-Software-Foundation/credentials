---
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { getCredentialBySlug } from "@/data/credentials";
import Cta from "@/components/cta.astro";
import PageLayout from "@/layouts/PageLayout.astro";
import BadgeIcon from "@/assets/icons/rounded-star.svg";
import BookIcon from "@/assets/icons/book.svg";
import WhatWillYouLearnIcon from "@/assets/icons/what-youll-learn.svg";
import RoundedCheckIcon from "@/assets/icons/rounded-check.svg";
import ExternalLinkIcon from "@/assets/icons/external-link.svg";
import DurationIcon from "@/assets/icons/duration.svg";
import CostIcon from "@/assets/icons/cost.svg";
import EarningCriteriaIcon from "@/assets/icons/criteria.svg";

const { slug } = Astro.params;

if (!slug) {
  return Astro.redirect("/404");
}

const credential = await getCredentialBySlug(slug);

if (!credential) {
  return Astro.redirect("/404");
}

const primaryCtaText = credential.primaryCtaText || "More Info";
const primaryCtaUrl = credential.primaryCtaUrl || "/#credentials";
---

<PageLayout
  title={`${credential.title} - Green Software Foundation`}
  mainClass="py-10 md:py-14 lg:py-16"
>
  <section class="container">
    <Card>
      <div class="flex flex-col items-center md:flex-row">
        <div class="shrink-0 p-10 lg:p-16">
          <img
            src="/assets/card-badge.svg"
            alt={`${credential.title} badge`}
            class="size-40 object-contain lg:size-53"
          />
        </div>
        <div class="space-y-4">
          <Badge>
            <BadgeIcon />
            {credential.badgeLabel}
          </Badge>
          <h1 class="text-3xl font-bold text-primary md:text-4xl">
            {credential.title}
          </h1>
          <p class="text-base text-black md:text-lg">{credential.heroDescription}</p>
        </div>
      </div>
    </Card>

    <div class="mt-4 flex w-full flex-col gap-4 lg:flex-row">
      <Card className="p-8 lg:basis-[75%]">
        <div class="space-y-3">
          <h2 class="flex items-center gap-2 text-xl font-bold text-primary md:text-2xl">
            <BookIcon />
            About
          </h2>
          <div class="space-y-3 text-sm text-gray-darker md:text-base">
            {credential.aboutParagraphs.map((paragraph) => <p>{paragraph}</p>)}
          </div>
        </div>

        <div class="my-8 h-px w-full bg-gray"></div>

        <h3 class="flex items-center gap-2 text-xl font-bold text-primary md:text-2xl">
          <WhatWillYouLearnIcon />
          What You&apos;ll Learn
        </h3>
        <ul class="mt-4 text-gray-darker">
          {
            credential.whatYoullLearn.map((item) => (
              <li class="mt-4 flex items-center gap-3 first:mt-0">
                <RoundedCheckIcon />
                <span>{item}</span>
              </li>
            ))
          }
        </ul>
      </Card>

      <Card className="h-fit p-6 lg:basis-[25%]">
        <Button variant="primary">
          <a href={primaryCtaUrl} class="flex items-center gap-2">
            {primaryCtaText}
            <ExternalLinkIcon />
          </a>
        </Button>
        <div class="mt-3.5">
          <div class="flex items-center gap-2.5">
            <div class="shrink-0">
              <DurationIcon />
            </div>
            <div>
              <p class="text-sm font-medium text-primary-darker">Duration</p>
              <p class="text-sm text-gray-darker">{credential.duration}</p>
            </div>
          </div>
          <div class="mt-3 flex items-center gap-2.5">
            <div class="shrink-0">
              <CostIcon />
            </div>
            <div>
              <p class="text-sm font-medium text-primary-darker">Cost</p>
              <p class="text-sm text-gray-darker">{credential.cost}</p>
            </div>
          </div>
          <div class="mt-3 flex items-start gap-2.5">
            <div class="shrink-0">
              <EarningCriteriaIcon />
            </div>
            <div>
              <p class="text-sm font-medium text-primary-darker">Earning Criteria</p>
              <ul class="mt-1 list-disc space-y-1 pl-5 text-sm text-gray-darker">
                {credential.earningCriteria.map((item) => <li>{item}</li>)}
              </ul>
            </div>
          </div>
        </div>
      </Card>
    </div>
  </section>

  <Cta
    sectionId="ready-to-build"
    sectionClass="pt-10 md:pt-12 lg:pt-16"
    title="Ready to Build Sustainable Software?"
    description="Take the next step in your green software journey. Get certified, access exclusive resources, and join thousands of practitioners making a real impact on our planet's future."
    buttonText="See all certs"
    buttonVariant="primary"
    buttonHref="/#credentials"
    imageSrc="/assets/ready-to-build.svg"
    imageAlt="Ready to build sustainable software"
  />
</PageLayout>
